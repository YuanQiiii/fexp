# 视觉工作记忆实验文档

本文档详细描述了一项旨在研究视觉工作记忆中空间注意分配机制的实验。实验通过呈现彩色图形阵列，要求被试记忆图形的颜色及其位置，并在短暂延迟后判断探测项目的颜色是否发生变化。

## 1.1 实验仪器与材料

### 1.1.1 实验仪器
* **计算机**: 一台能够运行 MATLAB 及 Psychtoolbox-3 的标准PC或Mac。
* **显示器**: 实验程序会自动选择外接显示器（如果存在）进行刺激呈现。屏幕分辨率和物理尺寸由程序自动获取。
* **键盘**: 用于被试反应输入（“相同”反应键，“不同”反应键，退出键）和实验流程控制（如继续指导语）。

### 1.1.2 实验软件
* **MATLAB**: 实验脚本的编程与运行环境。
* **Psychtoolbox-3**: 用于精确控制刺激呈现和反应时间记录的 MATLAB 工具箱。

### 1.1.3 实验材料 (视觉刺激)
* **被试信息输入界面**:
    * 包含字段：被试编号、年龄、性别、实验次序。
    * 默认输入示例：P01, 20, 男, 1。
* **背景颜色**:
    * 中性灰 (`[128, 128, 128]`)。
* **注视点**:
    * 形状：圆形 (通过 `Screen('FillOval')` 绘制)。
    * 大小：`0.6` 视角 (`fixationCrossSize_deg`)。
    * 颜色：白色 (`[255, 255, 255]`)。
* **记忆项目 (Items)**:
    * 数量：固定为 `6` 个 (`numItems`)。
    * 形状：圆形 (`'circle'`) 和方形 (`'square'`)，每种形状 `3` 个 (`itemShapes`, `numShapesEach`)。
    * 尺寸：直径/边长为 `1.2` 视角 (`itemDiameter_deg`)。
    * 边框：`1` 像素黑色边框 (`itemBorderPx`, `borderColorRGB = [0,0,0]`)。
    * 颜色：从以下 `8` 种高区分度颜色中随机无放回抽取 (`colorsRGB`):
        1.  红色: `[255, 0, 0]`
        2.  绿色: `[0, 255, 0]`
        3.  蓝色: `[0, 0, 255]`
        4.  黄色: `[255, 255, 0]`
        5.  品红: `[255, 0, 255]`
        6.  青色: `[0, 255, 255]`
        7.  橙色: `[255, 128, 0]`
        8.  紫色: `[128, 0, 255]`
* **虚拟网格 (Visual Grid)**:
    * 大小：`6x6` (`gridSize`)。
    * 单元格尺寸：`2.0` 视角 (`cellSi_deg`)。
    * 总显示区域：以屏幕中心为中心的 `12.0 x 12.0` 视角区域 (`totalDisplayArea_deg`)。
    * 网格线颜色：灰色 (`[100, 100, 100]`)，用于辅助定位，在记忆阵列和探测阵列呈现时显示。
* **指导语**:
    * 字体大小：`0.5` 视角 (`instructionFontSize_deg`)。
    * 内容：包括欢迎语、任务解释、按键说明、练习阶段说明、正式实验开始说明、区块间休息提示以及实验结束感谢语。
* **观看距离**:
    * 固定为 `60` 厘米 (`viewingDistance_cm`)，用于将视角单位转换为像素单位。

## 1.2 实验设计

### 1.2.1 设计类型
本实验采用**单因素被试内设计**。

* **自变量 (Independent Variable)**:
    * **布局条件 (Layout Condition)**: 包含两个水平：
        1.  **邻近分组 (Neighbor Grouping)**: 6个项目被分成2组（每组3个）或3组（每组2个）。组内项目中心点最大距离 (`groupMaxDistance_deg = 2.8°`) 受到限制，组间项目最小距离 (`interGroupMinDistance_deg = 4.0°`) 受到限制。项目优先放置于虚拟网格的单元格中心。
        2.  **随机控制 (Random Control)**: 6个项目在显示区域内随机放置（但仍优先放置于虚拟网格的单元格中心）。项目中心点最小间距 (`itemCenterMinDistance_deg_random = 2.5°`) 和项目边缘最小间距 (`itemEdgeMinDistance_deg_random = 1.3°`) 受到限制，以避免重叠和过度拥挤。

* **因变量 (Dependent Variables)**:
    * **准确率 (Accuracy)**: 被试判断探测项目颜色是否与记忆中相同的正确比例（1为正确，0为错误）。
    * **反应时 (Reaction Time, RT)**: 从探测项目呈现开始到被试按键反应的时间（单位：秒）。

### 1.2.2 试次结构与数量
* **总试次数**: `120` 个 (`numTotalTrials`)。
* **条件重复次数**: 每个布局条件包含 `60` 个试次 (`trialsPerCondition`)。
* **实验区块 (Blocks)**: 共 `2` 个区块 (`numBlocks`)，每个区块 `60` 个试次 (`trialsPerBlock`)。
* **变化试次比例**: `50%` 的试次为“有变化”试次 (`changeTrialPercentage`)，即探测项目的颜色与记忆阵列中对应位置项目的颜色不同。另外 `50%` 为“无变化”试次。

### 1.2.3 平衡与随机化
* **条件顺序**: 两种布局条件的试次在整个实验中伪随机混合，通过 `randperm` 函数实现。
* **项目颜色**: 在每个试次的记忆阵列中，从 `8` 种备选颜色中无放回地随机抽取 `6` 种颜色分配给 `6` 个项目。
* **项目形状**: `3` 个圆形和 `3` 个方形随机分配给 `6` 个项目。
* **探测项目选择**: 在每个试次中，从记忆阵列的 `6` 个项目中随机选择一个作为探测项目。
* **变化试次的颜色选择**: 如果是“有变化”试次，探测项目的新颜色将从记忆阵列中未使用的颜色中随机选择一种。

### 1.2.4 反应按键
* **“相同”键**: `F` 键 (`sameKey`)。
* **“不同”键**: `J` 键 (`differentKey`)。
* **退出键**: `ESCAPE` 键，允许被试在实验过程中随时中止实验。
* 按键名称通过 `KbName('UnifyKeyNames')` 标准化。

### 1.2.5 时间参数 (单位：秒)
* **注视点呈现时间**: `0.500` 秒 (`fixationDuration`)。
* **记忆阵列呈现时间**: `0.500` 秒 (`memoryArrayDuration`)。
* **记忆保持间隔时间**: `1.000` 秒 (`retentionIntervalDuration`)，期间屏幕为空白背景。
* **最大反应时间窗口**: `3.000` 秒 (`responseWindowDuration`)。
* **试次间隔时间 (ITI)**: `0.700` 秒 (`interTrialInterval`)，期间屏幕为空白背景。

## 1.3 实验程序

### 1.3.1 准备阶段
1.  **被试信息采集**: 程序开始时，弹出一个对话框，要求实验员输入被试编号、年龄、性别和实验次序。如果取消输入，程序将退出。
2.  **屏幕与参数初始化**:
    * 打开 Psychtoolbox 屏幕窗口，使用中性灰背景色。
    * 开启透明度混合。
    * 设置中文字体支持。
    * 获取屏幕中心坐标、帧刷新率等信息。
    * 将所有以视角为单位的参数（如项目大小、间距等）根据设定的观看距离 (`60 cm`) 和屏幕参数转换为像素单位。
    * 隐藏鼠标指针，限制终端字符读取。
3.  **数据结构预分配**: 初始化用于存储实验结果的 `results` 结构体。

### 1.3.2 指导语与练习阶段
1.  **欢迎指导语**: 在屏幕上呈现欢迎信息、任务描述（记住彩色图形的颜色及其位置，判断探测项目颜色是否相同）、按键说明（F键相同，J键不同）、反应要求（快而准）以及练习说明。被试按任意键继续。
2.  **练习试次 (Practice Trials)**:
    * 进行约 `20` 个练习试次 (`numPracticeTrials`)。练习试次的条件（邻近分组/随机控制）也是随机混合的。
    * 练习试次的流程与正式实验基本一致，但**包含反馈**: 每次反应后，屏幕会显示“正确！”、“错误。”或“超时！”的文本反馈，持续 `1.5` 秒。
    * 如果在练习中布局生成失败，会提示并跳过该试次。
    * 练习试次允许按 `ESCAPE` 键中止练习并返回主实验流程。
3.  **正式实验开始指导语**: 告知被试练习结束，接下来将开始正式实验。强调正式实验中将**不再有正确或错误的反馈**，并重申任务要求。被试按任意键继续。

### 1.3.3 正式实验阶段
实验分为 `2` 个区块，每个区块包含 `60` 个试次。

1.  **区块开始提示**: 每个区块开始前，屏幕会显示提示信息（例如“第 1 部分，共 2 部分。按任意键开始。”）。被试按任意键开始该区块的试次。
2.  **单个试次流程**:
    * **(1) 试次间歇 (ITI)**: 呈现 `0.700` 秒的空白灰屏。
    * **(2) 注视点**: 在屏幕中央呈现 `0.500` 秒的白色圆形注视点。
    * **(3) 记忆阵列呈现**:
        * 根据当前试次的条件（邻近分组或随机控制），调用相应的函数 (`GenerateNeighborGroupLayout` 或 `GenerateRandomLayout`) 生成 `6` 个项目的位置。项目位于预定义的虚拟网格之上。
            * 如果邻近分组布局生成失败，则自动尝试使用随机布局作为后备。
            * 如果两种布局都失败，则使用一个简单的备用网格布局，并记录警告信息。
        * 随机分配形状（3圆3方）和颜色（从8种中选6种不重复）给这6个项目。
        * 在灰色背景上同时呈现所有 `6` 个带黑色边框的彩色形状以及背景网格线，持续 `0.500` 秒。
    * **(4) 记忆保持间隔**: 呈现 `1.000` 秒的空白灰屏。
    * **(5) 测试阵列呈现 (单项目探测)**:
        * 从记忆阵列的 `6` 个项目中随机选择一个作为探测项目。
        * 该探测项目在其原始位置上再次呈现，同时显示背景网格线。
        * 有 `50%` 的概率，探测项目的颜色与记忆阵列中该位置项目的原始颜色**相同**（无变化试次，正确反应为按 `F` 键）。
        * 有 `50%` 的概率，探测项目的颜色会变成记忆阵列中未使用过的一种新颜色（有变化试次，正确反应为按 `J` 键）。探测项目的形状保持不变。
    * **(6) 收集反应**:
        * 探测项目呈现后，被试有最多 `3.000` 秒的时间进行按键反应（`F` 或 `J`）。
        * 记录被试的按键 (`participantResponseKey`) 和反应时间 (`rt`)。
        * 如果超时未反应，则反应时记录为 `NaN`，按键记录为 `NaN`。
        * 在此期间，按 `ESCAPE` 键会中止整个实验，并尝试保存已收集的数据。
    * **(7) 准确性判断**: 根据被试的反应和当前试次是否为变化试次，判断反应是否正确 (`accuracy`，1为正确，0为错误或超时）。
    * **(8) 数据存储**: 将当前试次的所有相关信息（区块号、试次号、条件、项目位置/形状/颜色、探测项目信息、是否变化、预期反应、被试反应、反应时、准确性等）存储到 `results.trials` 结构体数组中。
    * **(9) 短暂暂停**: 反应后，屏幕变回空白灰屏（清除探测项目），然后进入下一个试次的ITI。

3.  **区块结束**: 完成一个区块的所有试次后，**增量保存当前所有收集到的数据**到 .mat 文件（文件名包含被试ID、会话号和区块号，例如 `P01_session1_block1_tempData.mat`）。

### 1.3.4 实验结束阶段
1.  **结束语**: 所有区块完成后，屏幕呈现感谢被试参与的结束语，并简要说明实验目的。指导语停留若干秒后自动或按键关闭。
2.  **最终数据保存**: 将包含所有试次数据的 `results` 结构体完整保存到最终的 .mat 文件（文件名包含被试ID和会话号，例如 `P01_session1_finalData.mat`）。
3.  **清理**: 关闭 Psychtoolbox 屏幕，显示鼠标指针，恢复终端字符读取。

### 1.3.5 错误处理
* 如果在实验过程中发生任何未预期的错误，程序会尝试捕获错误信息（`try-catch` 结构）。
* 发生错误时，程序会尝试关闭屏幕、显示鼠标指针，并在MATLAB命令行窗口显示错误信息（包括错误消息、类型和堆栈跟踪）。
* 同时，程序会尝试将当前已收集的 `results` 数据和错误对象 `ME` 保存到一个 .mat 文件中（文件名通常包含被试ID及 "errorData" 标识），以便后续分析和调试。
